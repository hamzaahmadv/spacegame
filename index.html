<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Space Shooter Game</title>
  
  <!-- Load p5.js with error handling -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js" 
          onerror="alert('Failed to load p5.js library. Please check your internet connection and refresh the page.')"></script>
  
  <script>
    // Check if p5.js loaded correctly
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof p5 === 'undefined') {
        console.error('p5.js is not loaded correctly');
        alert('Failed to load p5.js library. Please check your internet connection and refresh the page.');
      } else {
        console.log('p5.js loaded successfully');
      }
    });
  </script>
  
  <!-- Add Supabase client library with proper module handling -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js" 
          onerror="handleSupabaseLoadError()"></script>
  
  <script>
    // Handle Supabase load error
    function handleSupabaseLoadError() {
      console.error('Failed to load Supabase library. Leaderboard functionality will be disabled.');
      // Create a dummy supabase object to prevent errors
      window.supabaseClient = {
        createClient: function() {
          console.warn('Using dummy Supabase client');
          return {
            from: function() {
              return {
                select: function() { return this; },
                insert: function() { return this; },
                order: function() { return this; },
                limit: function() { 
                  return { 
                    data: [], 
                    error: { message: 'Supabase not available' } 
                  }; 
                }
              };
            }
          };
        }
      };
    }
    
    // Make sure Supabase is available globally
    document.addEventListener('DOMContentLoaded', function() {
      // Check if Supabase is loaded
      if (typeof supabase !== 'undefined') {
        window.supabaseClient = supabase;
        console.log('Supabase assigned to window object');
      } else {
        console.error('Supabase library not loaded correctly');
        handleSupabaseLoadError();
      }
    });
  </script>
  
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #000;
      width: 100%;
      height: 100%;
    }
    
    body {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    #game-container {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    canvas {
      display: block !important;
      margin: 0 auto !important;
      z-index: 1;
    }
    
    /* Styles for leaderboard input */
    #leaderboardInput {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 30, 0.8);
      border: 2px solid #4080ff;
      border-radius: 10px;
      padding: 20px;
      color: white;
      text-align: center;
      font-family: Arial, sans-serif;
      z-index: 100;
      width: 80%;
      max-width: 300px;
    }
    #leaderboardInput input {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #4080ff;
      background-color: rgba(0, 0, 50, 0.5);
      color: white;
    }
    #leaderboardInput button {
      background-color: #4080ff;
      color: white;
      border: none;
      padding: 8px 15px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
    }
    #leaderboardInput button:hover {
      background-color: #5090ff;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <!-- Leaderboard input form -->
    <div id="leaderboardInput">
      <h2>Submit Your Score</h2>
      <p id="finalScoreDisplay"></p>
      <input type="email" id="playerEmail" placeholder="Enter your email" required>
      <div>
        <button id="submitScore">Submit</button>
        <button id="skipSubmission">Skip</button>
      </div>
    </div>
  </div>

  <!-- Load game classes in dependency order -->
  <script src="star.js"></script>
  <script src="bullet.js"></script>
  <script src="player.js"></script>
  <script src="ships.js"></script>
  <script src="enemy.js"></script>
  <script src="smartenemy.js"></script>
  <script src="boss.js"></script>
  <script src="powerup.js"></script>
  <script src="achievements.js"></script>
  <script src="leaderboard.js"></script>
  <script src="sketch.js"></script>
  
  <script>
    // Additional script to ensure canvas is visible
    document.addEventListener('DOMContentLoaded', function() {
      // Check if canvas exists after a short delay
      setTimeout(function() {
        const canvas = document.querySelector('canvas');
        if (canvas) {
          console.log('Canvas found:', canvas);
          // Ensure canvas is visible
          canvas.style.display = 'block';
          canvas.style.visibility = 'visible';
        } else {
          console.error('Canvas not found after game initialization');
        }
      }, 1000);
    });
  </script>
</body>
</html> 